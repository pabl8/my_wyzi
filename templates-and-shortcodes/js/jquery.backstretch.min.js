/*! Backstretch - v2.0.4 - 2013-06-19
* http://srobbin.com/jquery-plugins/backstretch/
* Copyright (c) 2013 Scott Robbin; Licensed MIT */
(function(a,d,p){a.fn.backstretch=function(c,b){(c===p||0===c.length)&&a.error("No images were supplied for Backstretch");0===a(d).scrollTop()&&d.scrollTo(0,0);return this.each(function(){var d=a(this),g=d.data("backstretch");if(g){if("string"==typeof c&&"function"==typeof g[c]){g[c](b);return}b=a.extend(g.options,b);g.destroy(!0)}g=new q(this,c,b);d.data("backstretch",g)})};a.backstretch=function(c,b){return a("body").backstretch(c,b).data("backstretch")};a.expr[":"].backstretch=function(c){return a(c).data("backstretch")!==p};a.fn.backstretch.defaults={centeredX:!0,centeredY:!0,duration:5E3,fade:0};var r={left:0,top:0,overflow:"hidden",margin:0,padding:0,height:"100%",width:"100%",zIndex:-999999},s={position:"absolute",display:"none",margin:0,padding:0,border:"none",width:"auto",height:"auto",maxHeight:"none",maxWidth:"none",zIndex:-999999},q=function(c,b,e){this.options=a.extend({},a.fn.backstretch.defaults,e||{});this.images=a.isArray(b)?b:[b];a.each(this.images,function(){a("<img />")[0].src=this});this.isBody=c===document.body;this.jQuerycontainer=a(c);this.jQueryroot=this.isBody?l?a(d):a(document):this.jQuerycontainer;c=this.jQuerycontainer.children(".backstretch").first();this.jQuerywrap=c.length?c:a('<div class="backstretch"></div>').css(r).appendTo(this.jQuerycontainer);this.isBody||(c=this.jQuerycontainer.css("position"),b=this.jQuerycontainer.css("zIndex"),this.jQuerycontainer.css({position:"static"===c?"relative":c,zIndex:"auto"===b?0:b,background:"none"}),this.jQuerywrap.css({zIndex:-999998}));this.jQuerywrap.css({position:this.isBody&&l?"fixed":"absolute"});this.index=0;this.show(this.index);a(d).on("resize.backstretch",a.proxy(this.resize,this)).on("orientationchange.backstretch",a.proxy(function(){this.isBody&&0===d.pageYOffset&&(d.scrollTo(0,1),this.resize())},this))};q.prototype={resize:function(){try{var a={left:0,top:0},b=this.isBody?this.jQueryroot.width():this.jQueryroot.innerWidth(),e=b,g=this.isBody?d.innerHeight?d.innerHeight:this.jQueryroot.height():this.jQueryroot.innerHeight(),j=e/this.jQueryimg.data("ratio"),f;j>=g?(f=(j-g)/2,this.options.centeredY&&(a.top="-"+f+"px")):(j=g,e=j*this.jQueryimg.data("ratio"),f=(e-b)/2,this.options.centeredX&&(a.left="-"+f+"px"));this.jQuerywrap.css({width:b,height:g}).find("img:not(.deleteable)").css({width:e,height:j}).css(a)}catch(h){}return this},show:function(c){if(!(Math.abs(c)>this.images.length-1)){var b=this,e=b.jQuerywrap.find("img").addClass("deleteable"),d={relatedTarget:b.jQuerycontainer[0]};b.jQuerycontainer.trigger(a.Event("backstretch.before",d),[b,c]);this.index=c;clearInterval(b.interval);b.jQueryimg=a("<img />").css(s).bind("load",function(f){var h=this.width||a(f.target).width();f=this.height||a(f.target).height();a(this).data("ratio",h/f);a(this).fadeIn(b.options.speed||b.options.fade,function(){e.remove();b.paused||b.cycle();a(["after","show"]).each(function(){b.jQuerycontainer.trigger(a.Event("backstretch."+this,d),[b,c])})});b.resize()}).appendTo(b.jQuerywrap);b.jQueryimg.attr("src",b.images[c]);return b}},next:function(){return this.show(this.index<this.images.length-1?this.index+1:0)},prev:function(){return this.show(0===this.index?this.images.length-1:this.index-1)},pause:function(){this.paused=!0;return this},resume:function(){this.paused=!1;this.next();return this},cycle:function(){1<this.images.length&&(clearInterval(this.interval),this.interval=setInterval(a.proxy(function(){this.paused||this.next()},this),this.options.duration));return this},destroy:function(c){a(d).off("resize.backstretch orientationchange.backstretch");clearInterval(this.interval);c||this.jQuerywrap.remove();this.jQuerycontainer.removeData("backstretch")}};var l,f=navigator.userAgent,m=navigator.platform,e=f.match(/AppleWebKit\/([0-9]+)/),e=!!e&&e[1],h=f.match(/Fennec\/([0-9]+)/),h=!!h&&h[1],n=f.match(/Opera Mobi\/([0-9]+)/),t=!!n&&n[1],k=f.match(/MSIE ([0-9]+)/),k=!!k&&k[1];l=!((-1<m.indexOf("iPhone")||-1<m.indexOf("iPad")||-1<m.indexOf("iPod"))&&e&&534>e||d.operamini&&"[object OperaMini]"==={}.toString.call(d.operamini)||n&&7458>t||-1<f.indexOf("Android")&&e&&533>e||h&&6>h||"palmGetResource"in d&&e&&534>e||-1<f.indexOf("MeeGo")&&-1<f.indexOf("NokiaBrowser/8.5.0")||k&&6>=k)})(jQuery,window);


jQuery(document).ready(function() {
    /*
        Form
    */
    jQuery('#wyz_frontend_businesses fieldset:first-child').fadeIn('slow');
    
    jQuery('#wyz_frontend_businesses input[type="text"], #wyz_frontend_businesses input[type="password"], #wyz_frontend_businesses textarea').on('focus', function() {
    	jQuery(this).removeClass('input-error');
    });

    toastr.options.closeMethod = 'fadeOut';
    toastr.options.showEasing = 'swing';
    toastr.options.hideEasing = 'swing';
    toastr.options.closeDuration = 300;
    toastr.options.preventDuplicates = true;
    toastr.options.timeOut = 1000;

    var current_fs, next_fs, previous_fs; //fieldsets
	var left, opacity, scale; //fieldset properties which we will animate
    var animating; //flag to prevent quick multi-click glitches
    var pageTop = jQuery('.page-title-social').length ? jQuery('.page-title-social') : ( jQuery('.page-banner-area').length ? jQuery('.page-banner-area') : (jQuery('#content').length?jQuery('#content'):null) );
    
    //display publish button if the form has no prev and nxt buttons
    var fieldsettest = jQuery('#wyz_frontend_businesses fieldset:first-child');
    if(fieldsettest.is(':last-child')){
        jQuery('.btn-square.button-primary').fadeIn('fast');
    }
    // next step
    jQuery('#wyz_frontend_businesses .btn-next').on('click', function() {
    	var parent_fieldset = jQuery(this).parents('fieldset');
    	var next_step = true;
    	
    	parent_fieldset.find('input, textarea').each(function() {
            if('email'==jQuery(this).attr('type')&&!isValidEmailAddress(jQuery(this).val())){
                if('email'==jQuery(this).attr('type')&&jQuery(this).val()!='')
                    toastr.warning('Improper Email Format');
                next_step = false;
                jQuery(this).focus();
                return false;
            }
    		if( jQuery(this).prop('required')&&jQuery(this).val()=='' ) {
    			jQuery(this).addClass('input-error');
    			next_step = false;
                jQuery(this).focus();
                
                toastr.error('Field required');
                return false;
    		}
    		else {
    			jQuery(this).removeClass('input-error');
    		}
    	});
    	
    	if( next_step ) {
    		parent_fieldset.fadeOut(400, function() {
	    		jQuery(this).next().fadeIn(400, function(){
                    if(pageTop)
                    jQuery("html, body").animate({
                        scrollTop: pageTop.offset().top
                    }, 300);

					if(jQuery('.pw-map').length){
						google.maps.event.trigger(jQuery('.pw-map')[0], 'resize');
					}
					if(jQuery(this).is(':last-child')){
                        jQuery('.btn-square.button-primary').fadeIn('fast');
                    }
	    		});
	    	});
	    	current_fs = jQuery(this).parent();
			next_fs = jQuery(this).parent().next();
			jQuery("#business-progressbar li").eq(jQuery("fieldset").index(next_fs)).addClass("active");
    	}
    	
    });
    
    // previous step
    jQuery('#wyz_frontend_businesses .btn-previous').on('click', function() {
    	jQuery(this).parents('fieldset').fadeOut(400, function() {
    		jQuery(this).prev().fadeIn();
    	});

    	current_fs = jQuery(this).parent();
		previous_fs = jQuery(this).parent().prev();
		//de-activate current step on progressbar
		jQuery("#business-progressbar li").eq(jQuery("fieldset").index(current_fs)).removeClass("active");

    	if(jQuery('.btn-square.button-primary').is(':visible'))
			jQuery('.btn-square.button-primary').fadeOut('fast');
    });

});
function isValidEmailAddress(emailAddress) {
    if(''==emailAddress)return true;
    var pattern = /^([a-z\d!#$%&'*+\-\/=?^_`{|}~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+(\.[a-z\d!#$%&'*+\-\/=?^_`{|}~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+)*|"((([ \t]*\r\n)?[ \t]+)?([\x01-\x08\x0b\x0c\x0e-\x1f\x7f\x21\x23-\x5b\x5d-\x7e\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|\\[\x01-\x09\x0b\x0c\x0d-\x7f\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))*(([ \t]*\r\n)?[ \t]+)?")@(([a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|[a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF][a-z\d\-._~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]*[a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])\.)+([a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|[a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF][a-z\d\-._~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]*[a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])\.?$/i;
    return pattern.test(emailAddress);
};